imsdir      = '~/Datasets/HorsesTrain/';
labelsdir   = '~/Datasets/HorsesTrainLabels/';
imsdirT     = '~/Datasets/HorsesTest/';
labelsdirT  = '~/Datasets/HorsesTestLabels/';
nvals       = 2;
maxims      = 200;

feat_params = {{'patches',0},{'position',1},{'fourier',1},{'hog',8}};
edge_params = {{'const'},{'diffthresh'},{'sobelthresh'},{'pairtypes'}};

loss_spec ={'trunc_ul_trw_0',...
            'trunc_em_trw_10',...
            'trunc_em_trw_20',...
            'trunc_em_trw_40',...
            'trunc_acc5_trw_10',...
            'trunc_acc5_trw_20',...
            'trunc_acc5_trw_40',...
            'trunc_acc15_trw_10',...
            'trunc_acc15_trw_20',...
            'trunc_acc15_trw_40',...
            'trunc_acc50_trw_10',...
            'trunc_acc50_trw_20',...
            'trunc_acc50_trw_40',...
            'trunc_ul_trw_10',...
            'trunc_ul_trw_20',...
            'trunc_ul_trw_40',...
            'trunc_cl_trw_10',...
            'trunc_cl_trw_20',...
            'trunc_cl_trw_40',...
            'trunc_em_mnf_10',...
            'trunc_em_mnf_20',...
            'trunc_em_mnf_40',...
            'trunc_ul_mnf_10',...
            'trunc_ul_mnf_20',...
            'trunc_ul_mnf_40',...
            'trunc_cl_mnf_10',...
            'trunc_cl_mnf_20',...
            'trunc_cl_mnf_40',...
            'pseudo',...
            'piecewise'};
        
who2init = ones(length(loss_spec),1);
who2init(1)      = 0;
who2init(5:3:11) = 2; % acc_10
who2init(6:3:12) = 3; % acc_20
who2init(7:3:13) = 4; % acc_40


% this loop trains the actual parameters

for i=1:length(loss_spec)
    if who2init(i)==0
        params0 = [];
    else
        params0  = params{who2init(i)};
    end
    testmode = 0;
    [params{i} times{i} fvals{i}] = train_labelers(...
        loss_spec{i},params0,testmode,...
        imsdir,labelsdir,nvals,feat_params,edge_params,maxims);
end

save experiment_horses

for i=1:length(loss_spec)
    params0  = params{i};
    testmode = ['train_' loss_spec{i}];
    fprintf('training error for %s ...\n', loss_spec{i});
    colormap gray
    train_labelers(loss_spec{i},params0,testmode,...
        imsdir,labelsdir,nvals,feat_params,edge_params,maxims);
    testmode = ['test_' loss_spec{i}];
    fprintf('test    error for %s ...\n', loss_spec{i});
    colormap gray
    train_labelers(loss_spec{i},params0,testmode,...
        imsdirT,labelsdirT,nvals,feat_params,edge_params);
end